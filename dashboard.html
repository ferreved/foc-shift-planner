<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOC Live Dashboard</title>
    <style>
        body { margin: 0; padding: 0; background: #f5f5f5; font-family: Arial, sans-serif; }
        .header { background: #232F3E; color: white; padding: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header-title { text-align: center; padding: 15px 0; margin: 0; font-size: 24px; color: #FF9900; }
        .nav-tabs { display: flex; justify-content: center; background: #37475A; }
        .nav-tab { padding: 12px 24px; color: white; text-decoration: none; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .nav-tab:hover { background: #4A5F7A; }
        .nav-tab.active { background: #FF9900; color: #232F3E; border-bottom-color: #FF9900; }
        .main-content { margin-top: 0; }
        .time-indicator { background: #ffebee !important; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .card { background: white; border-radius: 8px; padding: 20px; margin: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .input-group { display: flex; gap: 10px; align-items: center; margin: 10px 0; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-break { background: #28a745; color: white; }
        .btn-meeting { background: #007bff; color: white; }
        .status-online { color: #28a745; font-weight: bold; }
        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .time-slot { border: 1px solid #ddd; border-radius: 4px; padding: 10px; margin: 5px 0; }
        .current-time { background: #fff3cd; border-color: #ffeaa7; }
        .team-section { margin: 10px 0; }
        .engineer-list { display: flex; flex-wrap: wrap; gap: 5px; margin: 5px 0; }
        .engineer-tag { background: #e3f2fd; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .break-tag { background: #fff3cd; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .meeting-tag { background: #ffebee; padding: 2px 8px; border-radius: 12px; font-size: 12px; }
        .scoreboard { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .scoreboard-title { font-size: 28px; font-weight: bold; margin-bottom: 20px; color: #FFD700; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .scoreboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-box { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.2); }
        .stat-number { font-size: 36px; font-weight: bold; color: #FFD700; }
        .stat-label { font-size: 14px; margin-top: 5px; opacity: 0.9; }
        .team-divider { height: 2px; background: linear-gradient(to right, #ddd, #999, #ddd); margin: 15px 0; border-radius: 1px; }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="header">
        <h1 class="header-title">DUB Shift Planner</h1>
        <div class="nav-tabs">
            <a href="dashboard.html" class="nav-tab active">Dashboard</a>
            <a href="index.html" class="nav-tab">Create Schedule</a>
        </div>
    </div>
    <div id="app"></div>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDIF_gb3swfMlXFa4ZY4ZsoAZSwaqmiwm4",
            authDomain: "foc-dashboard.firebaseapp.com",
            databaseURL: "https://foc-dashboard-default-rtdb.firebaseio.com",
            projectId: "foc-dashboard",
            storageBucket: "foc-dashboard.firebasestorage.app",
            messagingSenderId: "869888485796",
            appId: "1:869888485796:web:82bf668dbfdc9c17a1f931"
        };
        
        let firebaseInitialized = false;
        let database, scheduleRef, breaksRef;
        
        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            scheduleRef = database.ref('schedule');
            breaksRef = database.ref('userInputs');
            firebaseInitialized = true;
        } catch (error) {
            firebaseInitialized = false;
        }
        
        const TIME_SLOTS = [
            { time: '07:00', label: '7:00' }, { time: '08:00', label: '8:00' }, { time: '09:00', label: '9:00' },
            { time: '10:00', label: '10:00' }, { time: '11:00', label: '11:00' }, { time: '12:00', label: '12:00' },
            { time: '13:00', label: '13:00' }, { time: '14:00', label: '14:00' }
        ];
        
        const MEETING_REASONS = ['1:1 Meeting', 'Other Meetings', 'Advocacy', 'Interview', 'Shadow', 'Project', 'Training'];
        const ALL_ENGINEERS = ['azjimene', 'ddunwood', 'xnevpaul', 'ssanthag', 'mwanyali', 'andrwmn', 'mcdlvega', 'criiliof', 'almelvio', 'rowhitei', 'tansthef', 'tracykie', 'shlakshy', 'kellyerd', 'ferreved'];
        
        let scheduleData = {};
        let userInputs = {};
        let currentTeam = 'A';
        
        function syncUserInput(data) {
            if (!firebaseInitialized) return;
            breaksRef.push(data).catch(err => console.log('Sync failed:', err));
        }
        
        function setupRealtimeSync() {
            if (!firebaseInitialized) return;
            
            // Listen to schedule changes from admin
            scheduleRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    scheduleData = data.scheduleData || {};
                    currentTeam = data.currentTeam || 'A';
                    updateDashboard();
                }
            });
            
            // Listen to user inputs (breaks/meetings)
            breaksRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    userInputs = data;
                    updateDashboard();
                }
            });
        }
        
        function initDashboard() {
            setupRealtimeSync();
            document.getElementById('app').innerHTML = `
                <div class="main-content" style="margin: 20px;">
                    
                    <!-- Live Status Board -->
                    <div class="scoreboard">
                        <div class="scoreboard-title">FOC LIVE STATUS</div>
                        <div id="live-status-content"></div>
                    </div>
                    
                    <!-- Current Time -->
                    <div class="card">
                        <div id="current-time" style="text-align: center; font-size: 24px; font-weight: bold; color: #007bff;"></div>
                    </div>
                    
                    <!-- Live Schedule Grid -->
                    <div id="schedule-grid" class="schedule-grid"></div>
                    
                    <!-- User Input Section -->
                    <div class="card">
                        <h3 style="margin-top: 0;">Add Your Break or Meeting</h3>
                        <div class="input-group">
                            <select id="user-alias" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">Select Engineer</option>
                                ${ALL_ENGINEERS.map(eng => `<option value="${eng}">${eng}</option>`).join('')}
                            </select>
                            <select id="time-slot" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">Select Time Slot</option>
                                ${TIME_SLOTS.map(slot => `<option value="${slot.time}">${slot.label}</option>`).join('')}
                            </select>
                        </div>
                        <div class="input-group">
                            <button class="btn btn-break" onclick="addBreak()">Add Break (15min + 30min lunch)</button>
                            <select id="meeting-duration" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="15">15 minutes</option>
                                <option value="30">30 minutes</option>
                                <option value="45">45 minutes</option>
                                <option value="60">1 hour</option>
                            </select>
                            <select id="meeting-reason" style="padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                                <option value="">Select Reason</option>
                                ${MEETING_REASONS.map(reason => `<option value="${reason}">${reason}</option>`).join('')}
                            </select>
                            <button class="btn btn-meeting" onclick="addMeeting()">Add Meeting</button>
                        </div>
                        <div id="sync-status" class="${firebaseInitialized ? 'status-online' : 'status-offline'}" style="margin-top: 10px;">
                            ${firebaseInitialized ? 'Live Sync ON' : '‚ö†Ô∏è Offline Mode'}
                        </div>
                    </div>
                </div>`;
            
            startTimeClock();
            updateDashboard();
        }
        
        function addBreak() {
            const alias = document.getElementById('user-alias').value;
            const timeSlot = document.getElementById('time-slot').value;
            
            if (!alias || !timeSlot) {
                alert('Please select an engineer and time slot');
                return;
            }
            
            const breakData = {
                type: 'break',
                alias: alias,
                timeSlot: timeSlot,
                duration: '15min + 30min lunch',
                timestamp: Date.now()
            };
            
            syncUserInput(breakData);
            
            // Clear inputs
            document.getElementById('user-alias').value = '';
            document.getElementById('time-slot').value = '';
            
            alert('Break added successfully!');
        }
        
        function addMeeting() {
            const alias = document.getElementById('user-alias').value;
            const timeSlot = document.getElementById('time-slot').value;
            const duration = document.getElementById('meeting-duration').value;
            const reason = document.getElementById('meeting-reason').value;
            
            if (!alias || !timeSlot || !duration || !reason) {
                alert('Please fill all meeting fields');
                return;
            }
            
            const meetingData = {
                type: 'meeting',
                alias: alias,
                timeSlot: timeSlot,
                duration: duration + ' minutes',
                reason: reason,
                timestamp: Date.now()
            };
            
            syncUserInput(meetingData);
            
            // Clear inputs
            document.getElementById('user-alias').value = '';
            document.getElementById('time-slot').value = '';
            document.getElementById('meeting-duration').value = '15';
            document.getElementById('meeting-reason').value = '';
            
            alert('Meeting added successfully!');
        }
        
        function updateDashboard() {
            updateScheduleGrid();
            updateLiveStatus();
        }
        
        function updateScheduleGrid() {
            const grid = document.getElementById('schedule-grid');
            if (!grid) return;
            
            const now = new Date();
            const currentHour = now.getHours();
            let currentTimeSlot = '';
            
            if (currentHour >= 7 && currentHour < 15) {
                currentTimeSlot = `${currentHour}:00`;
            }
            
            let gridHTML = '';
            
            TIME_SLOTS.forEach(slot => {
                const isCurrentTime = slot.time === currentTimeSlot;
                const data = scheduleData[slot.time] || { skg: [], textables: [], breaks: [], outOfOps: [] };
                
                // Get user inputs for this time slot
                const userBreaks = Object.values(userInputs || {}).filter(input => 
                    input.timeSlot === slot.time && input.type === 'break'
                );
                const userMeetings = Object.values(userInputs || {}).filter(input => 
                    input.timeSlot === slot.time && input.type === 'meeting'
                );
                
                gridHTML += `
                    <div class="time-slot ${isCurrentTime ? 'current-time' : ''}">
                        <h4 style="margin: 0 0 10px 0; color: ${isCurrentTime ? '#856404' : '#333'};">
                            ${slot.label} ${isCurrentTime ? '(CURRENT)' : ''}
                        </h4>
                        
                        <div class="team-section">
                            <strong style="color: #4CAF50;">üîç SKG Team:</strong>
                            <div class="engineer-list">
                                ${data.skg.filter(eng => eng).map(eng => `<span class="engineer-tag">${eng}</span>`).join('') || '<span style="color: #999;">No assignments</span>'}
                            </div>
                        </div>
                        
                        
                        <div class="team-divider"></div>
                        
                        <div class="team-section">
                            <strong style="color: #FF9800;">üìù Textables Team:</strong>
                            <div class="engineer-list">
                                ${data.textables.filter(eng => eng).map(eng => `<span class="engineer-tag">${eng}</span>`).join('') || '<span style="color: #999;">No assignments</span>'}
                            </div>
                        </div>
                        
                        <div class="team-section">
                            <strong style="color: #2196F3;">‚òï Breaks:</strong>
                            <div class="engineer-list">
                                ${data.breaks.filter(eng => eng).map(eng => `<span class="break-tag">${eng}</span>`).join('')}
                                ${userBreaks.map(brk => `<span class="break-tag">${brk.alias} (${brk.duration})</span>`).join('')}
                                ${(data.breaks.filter(eng => eng).length === 0 && userBreaks.length === 0) ? '<span style="color: #999;">No breaks</span>' : ''}
                            </div>
                        </div>
                        
                        <div class="team-section">
                            <strong style="color: #9C27B0;">üìÖ Meetings:</strong>
                            <div class="engineer-list">
                                ${data.outOfOps.filter(item => item.engineer).map(item => `<span class="meeting-tag">${item.engineer} - ${item.reason}</span>`).join('')}
                                ${userMeetings.map(mtg => `<span class="meeting-tag">${mtg.alias} - ${mtg.reason} (${mtg.duration})</span>`).join('')}
                                ${(data.outOfOps.filter(item => item.engineer).length === 0 && userMeetings.length === 0) ? '<span style="color: #999;">No meetings</span>' : ''}
                            </div>
                        </div>
                    </div>`;
            });
            
            grid.innerHTML = gridHTML;
        }
        
        function updateLiveStatus() {
            const now = new Date();
            const currentHour = now.getHours();
            let currentTimeSlot = '';
            
            if (currentHour >= 7 && currentHour < 15) {
                currentTimeSlot = `${currentHour}:00`;
            }
            
            const statusContent = document.getElementById('live-status-content');
            if (!statusContent) return;
            
            let statusHTML = `<div style="font-size: 18px; margin-bottom: 20px; color: #FFD700;">TEAM ${currentTeam} - ${currentTimeSlot || 'OFF HOURS'}</div>`;
            
            if (currentTimeSlot && scheduleData[currentTimeSlot]) {
                const data = scheduleData[currentTimeSlot];
                const skgCount = data.skg.filter(eng => eng !== '').length;
                const textablesCount = data.textables.filter(eng => eng !== '').length;
                const outOfOpsCount = data.outOfOps.filter(item => item.engineer !== '').length;
                
                // Count user inputs for current slot
                const userBreaksCount = Object.values(userInputs || {}).filter(input => 
                    input.timeSlot === currentTimeSlot && input.type === 'break'
                ).length;
                const userMeetingsCount = Object.values(userInputs || {}).filter(input => 
                    input.timeSlot === currentTimeSlot && input.type === 'meeting'
                ).length;
                
                const totalActive = skgCount + textablesCount;
                const totalOut = outOfOpsCount + userMeetingsCount + userBreaksCount;
                
                statusHTML += `
                    <div class="scoreboard-stats">
                        <div class="stat-box">
                            <div class="stat-number">${skgCount}</div>
                            <div class="stat-label">SKG ENGINEERS</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">${textablesCount}</div>
                            <div class="stat-label">TEXTABLES ENGINEERS</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">${totalActive}</div>
                            <div class="stat-label">TOTAL ACTIVE</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-number">${totalOut}</div>
                            <div class="stat-label">OUT OF OPS</div>
                        </div>
                    </div>`;
            } else {
                statusHTML += `<div style="font-size: 18px; opacity: 0.8;">Outside operational hours (7:00-15:00)</div>`;
            }
            
            statusContent.innerHTML = statusHTML;
        }
        
        function startTimeClock() {
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-GB', {
                    hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit'
                });
                
                const timeElement = document.getElementById('current-time');
                if (timeElement) {
                    timeElement.textContent = `Current Time: ${timeString}`;
                }
                
                // Update every minute
                if (now.getSeconds() === 0) {
                    updateDashboard();
                }
            }
            
            updateTime();
            setInterval(updateTime, 1000);
            setInterval(updateDashboard, 30000); // Refresh every 30 seconds
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
